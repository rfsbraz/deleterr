services:
  radarr:
    image: lscr.io/linuxserver/radarr:latest
    container_name: deleterr-test-radarr
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=UTC
    volumes:
      - radarr-config:/config
    tmpfs:
      - /movies:uid=1000,gid=1000
    ports:
      - "7878:7878"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:7878/ping"]
      interval: 10s
      timeout: 5s
      retries: 12
      start_period: 30s

  sonarr:
    image: lscr.io/linuxserver/sonarr:latest
    container_name: deleterr-test-sonarr
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=UTC
    volumes:
      - sonarr-config:/config
    tmpfs:
      - /tv:uid=1000,gid=1000
    ports:
      - "8989:8989"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8989/ping"]
      interval: 10s
      timeout: 5s
      retries: 12
      start_period: 30s

  tautulli:
    image: lscr.io/linuxserver/tautulli:latest
    container_name: deleterr-test-tautulli
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=UTC
    volumes:
      - ./seed_data/tautulli:/config
    ports:
      - "8181:8181"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8181/status"]
      interval: 10s
      timeout: 5s
      retries: 12
      start_period: 30s

  plex:
    image: plexinc/pms-docker:latest
    container_name: deleterr-test-plex
    environment:
      - PLEX_UID=1000
      - PGID=1000
      - TZ=UTC
      - PLEX_CLAIM=${PLEX_CLAIM:-}
      - ADVERTISE_IP=http://localhost:32400/
      # Disable some features for faster startup
      - ALLOWED_NETWORKS=0.0.0.0/0
    volumes:
      - plex-config:/config
      - plex-transcode:/transcode
      - ./seed_data/media:/data/media
    ports:
      - "32400:32400"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:32400/identity"]
      interval: 10s
      timeout: 5s
      retries: 30
      start_period: 30s

  webhook-receiver:
    build:
      context: ./fixtures
      dockerfile: Dockerfile.webhook-receiver
    container_name: deleterr-test-webhook-receiver
    ports:
      - "8080:8080"
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:8080/health"]
      interval: 5s
      timeout: 3s
      retries: 10
      start_period: 5s

  justwatch-proxy:
    build:
      context: ./fixtures
      dockerfile: Dockerfile.justwatch-proxy
    container_name: deleterr-test-justwatch-proxy
    ports:
      - "8888:8888"
    environment:
      - JUSTWATCH_VALIDATE_ON_STARTUP=true
      - JUSTWATCH_ALLOW_REAL_REQUESTS=false
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:8888/health"]
      interval: 5s
      timeout: 3s
      retries: 10
      start_period: 5s

volumes:
  radarr-config:
  sonarr-config:
  plex-config:
  plex-transcode:

networks:
  default:
    name: deleterr-test-network
